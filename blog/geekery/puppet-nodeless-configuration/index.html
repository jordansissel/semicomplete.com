<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <title>Puppet &#34;pure fact-driven&#34; nodeless configuration
 - semicomplete</title>
  <meta property="og:title" content="Puppet &#34;pure fact-driven&#34; nodeless configuration
 - semicomplete" />
  <meta name="twitter:title" content="Puppet &#34;pure fact-driven&#34; nodeless configuration
 - semicomplete" />
  <meta name="description" content="Truth should guide your configuration management tools.
Truth in this case is: what machines you have, properties of those machines, roles for those machines, etc. For example &ldquo;foo-1.a.example.com is a webserver&rdquo; is a piece of truth. Where and how you store truth is up to you and out of scope for this post.
My goal is to have truth steer everything about my infrastructure. Roles, jobs, and even long-term one-offs get put into the truth source (like a machine role, etc).">
  <meta property="og:description" content="Truth should guide your configuration management tools.
Truth in this case is: what machines you have, properties of those machines, roles for those machines, etc. For example &ldquo;foo-1.a.example.com is a webserver&rdquo; is a piece of truth. Where and how you store truth is up to you and out of scope for this post.
My goal is to have truth steer everything about my infrastructure. Roles, jobs, and even long-term one-offs get put into the truth source (like a machine role, etc).">
  <meta name="twitter:description" content="Truth should guide your configuration management tools.
Truth in this case is: what machines you have, properties of those machines, roles for those machines, etc. For example â€¦">
  <meta name="author" content="Jordan Sissel"/>
  <meta property="og:site_name" content="semicomplete" />
  <meta property="og:url" content="https://semicomplete.com/blog/geekery/puppet-nodeless-configuration/" />
  <meta property="og:type" content="article" />
  <meta name="twitter:card" content="summary" />
  <meta name="generator" content="Hugo 0.105.0">

  <link rel="stylesheet" href="/css/style.css" media="all" />
  <link rel="stylesheet" href="/css/syntax.css" media="all" />
  <link rel="stylesheet" href="/css/custom.css" media="all" />

  <script src="/js/script.js"></script>
  <script src="/js/custom.js"></script>
  <script defer src="/js/fontawesome.js"></script>
</head>

<body>

<header class="site-header">
  <nav class="site-navi">
    <h1 class="site-title"><a href="/">semicomplete</a></h1>
    <ul class="site-navi-items">
      <li class="site-navi-item-categories"><a href="/categories/" title="Categories">Categories</a></li>
      <li class="site-navi-item-tags"><a href="/tags/" title="Tags">Tags</a></li>
      <li class="site-navi-item-archives"><a href="/archives/" title="Archives">Archives</a></li>
      <li class="site-navi-item-about"><a href="/about/" title="About">About</a></li>
    </ul>
  </nav>
</header>
<hr class="site-header-bottom">

  <div class="main" role="main">
    <article class="article">
      
      
      <h1 class="article-title">Puppet &#34;pure fact-driven&#34; nodeless configuration
</h1>
      
      <hr class="article-title-bottom">
      <ul class="article-meta">
        <li class="article-meta-date"><time>27 November, 2010</time></li>
        <li class="article-meta-categories">
          <a href="/categories/old/">
            <i class="fas fa-folder"></i>
            old
          </a>&nbsp;
        </li>
        <li class="article-meta-tags">
          <a href="/tags/puppet/">
            <i class="fas fa-tag"></i>
            puppet
          </a>&nbsp;
        </li>
        <li class="article-meta-tags">
          <a href="/tags/nodeless/">
            <i class="fas fa-tag"></i>
            nodeless
          </a>&nbsp;
        </li>
        <li class="article-meta-tags">
          <a href="/tags/nodes/">
            <i class="fas fa-tag"></i>
            nodes
          </a>&nbsp;
        </li>
        <li class="article-meta-tags">
          <a href="/tags/classifier/">
            <i class="fas fa-tag"></i>
            classifier
          </a>&nbsp;
        </li>
        <li class="article-meta-tags">
          <a href="/tags/truth/">
            <i class="fas fa-tag"></i>
            truth
          </a>&nbsp;
        </li>
      </ul>
      
      <p>Truth should guide your configuration management tools.</p>
<p>Truth in this case is: what machines you have, properties of those machines,
roles for those machines, etc. For example &ldquo;foo-1.a.example.com is a webserver&rdquo;
is a piece of truth. Where and how you store truth is up to you and out of
scope for this post.</p>
<p>My goal is to have truth steer everything about my infrastructure. Roles, jobs,
and even long-term one-offs get put into the truth source (like a machine role,
etc). That way, if the machine with a one-off dies, I can just add that
machine role to another system and puppet will configure it - no pain and no
fire to fight.</p>
<p>A simple example of truth in puppet is puppet&rsquo;s &ldquo;node&rdquo; type. A simple example:</p>
<pre tabindex="0"><code>node &#34;foo-1.a.example.com&#34; {
  include apache
}
</code></pre><p>Specifying each node in puppet doesn&rsquo;t scale very well for many people.
Further, you may already have your node information in another tool (ldap,
mysql, etc).  To allow this, puppet lets you feed &rsquo;node&rsquo; information from an
external tool (called an <a href="http://docs.puppetlabs.com/guides/external_nodes.html">external node classifier</a>). However, I found that using an external node classifier also
has its drawbacks (also out of scope for this post).</p>
<p>To avoid complex logic in a node classifier, I&rsquo;ve got with a pure fact-based
puppet configuration which I call &ldquo;nodeless.&rdquo;</p>
<p>My puppet site.pp looks basically like this:</p>
<pre tabindex="0"><code>node default {
  include truth::enforcer
}
</code></pre><p>That&rsquo;s it. No extra nodes, no &lsquo;include&rsquo; or conditionals randomly sprayed around.</p>
<p>From there, I have the truth::enforcer class include other classes, do sanity
checking, etc, all based on facts (and properties if you use external node
classifier)</p>
<p>Fully standalone example with code can be found in <a href="https://github.com/jordansissel/puppet-examples/tree/master/nodeless-puppet/">jordansissel/puppet-examples</a>.</p>

    </article>

    


    <ul class="pager article-pager">
      <li class="pager-newer">
          <a href="/blog/growing-logstash-value/" data-toggle="tooltip" data-placement="top" title="Growing logstash&#39;s value">&lt; Newer</a>
      </li>
      <li class="pager-older">
        <a href="/blog/geekery/debugging-java-performance/" data-toggle="tooltip" data-placement="top" title="Debugging java threads with top(1) and jstack.
">Older &gt;</a>
      </li>
    </ul>
  </div>


<div class="site-footer">
  <div class="copyright">&copy; Copyright 2006-2019 Jordan Sissel - Content licensed as <a href='https://creativecommons.org/licenses/by-nc-sa/4.0/legalcode'>CC BY-NC-SA</a></div>
  <ul class="site-footer-items">
    <li class="site-footer-item-about"><a href="/about/" title="About">About</a></li>
  </ul>
  <div class="powerdby">
    Powered by <a href="https://gohugo.io/">Hugo</a> and <a href="https://github.com/taikii/whiteplain">Whiteplain</a>
  </div>
</div>


</body>
</html>
